{% extends "base.html" %}

{% block title %}Blog | Portfolio{% endblock %}

{% block content %}
<h1>Blog Posts</h1>

{% if current_user.is_authenticated %}
    <a href="{{ url_for('admin.new_post') }}" class="btn">New Post</a>
{% else %}
    <a href="{{ url_for('admin.login') }}" class="btn">Admin Login</a>
{% endif %}

{% for post in posts.items %}
<article class="blog-post">
    <h2><a href="{{ url_for('blog.blog_post', post_id=post.id) }}">{{ post.title }}</a></h2>
    <p class="date">{{ post.date_posted.strftime('%Y-%m-%d') }}</p>
    <p>{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
    <a href="{{ url_for('blog.blog_post', post_id=post.id) }}">Read more</a>
</article>
{% endfor %}

<div class="pagination">
    {% if posts.has_prev %}
        <a href="{{ url_for('blog.blog', page=posts.prev_num) }}">&laquo; Previous</a>
    {% endif %}
    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
            {% if posts.page == page_num %}
                <span class="current-page">{{ page_num }}</span>
            {% else %}
                <a href="{{ url_for('blog.blog', page=page_num) }}">{{ page_num }}</a>
            {% endif %}
        {% else %}
            <span class="ellipsis">...</span>
        {% endif %}
    {% endfor %}
    {% if posts.has_next %}
        <a href="{{ url_for('blog.blog', page=posts.next_num) }}">Next &raquo;</a>
    {% endif %}
</div>
{% endblock %}
