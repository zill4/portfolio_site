{% extends "base.html" %}

{% block title %}Admin Dashboard | Portfolio{% endblock %}

{% block content %}
<h1>Admin Dashboard</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<section id="blog-posts">
    <h2>Blog Posts</h2>
    <a href="{{ url_for('admin.new_post') }}" class="btn">Create New Post</a>
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Date Posted</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for post in posts.items %}
            <tr>
                <td>{{ post.title }}</td>
                <td>{{ post.date_posted.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    <a href="{{ url_for('admin.edit_post', post_id=post.id) }}" class="btn btn-small">Edit</a>
                    <form action="{{ url_for('admin.delete_post', post_id=post.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Are you sure you want to delete this post?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        {% for page in posts.iter_pages() %}
            {% if page %}
                {% if page != posts.page %}
                    <a href="{{ url_for('admin.dashboard', posts_page=page, projects_page=projects.page) }}">{{ page }}</a>
                {% else %}
                    <strong>{{ page }}</strong>
                {% endif %}
            {% else %}
                <span class="ellipsis">…</span>
            {% endif %}
        {% endfor %}
    </div>
</section>

<section id="projects">
    <h2>Projects</h2>
    <a href="{{ url_for('admin.new_project') }}" class="btn">Create New Project</a>
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects.items %}
            <tr>
                <td>{{ project.title }}</td>
                <td>
                    <a href="{{ url_for('admin.edit_project', project_id=project.id) }}" class="btn btn-small">Edit</a>
                    <form action="{{ url_for('admin.delete_project', project_id=project.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Are you sure you want to delete this project?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        {% for page in projects.iter_pages() %}
            {% if page %}
                {% if page != projects.page %}
                    <a href="{{ url_for('admin.dashboard', posts_page=posts.page, projects_page=page) }}">{{ page }}</a>
                {% else %}
                    <strong>{{ page }}</strong>
                {% endif %}
            {% else %}
                <span class="ellipsis">…</span>
            {% endif %}
        {% endfor %}
    </div>
</section>

{% endblock %}
